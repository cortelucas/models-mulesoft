<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:munit="http://www.mulesoft.org/schema/mule/munit" xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd">
	<munit:config name="main-test-suite.xml" />
	<munit:test name="main-success-test" doc:id="80c6bcbb-4836-43d6-9423-dc71fffeb78b" description="Test">
		<munit:behavior >
			<munit-tools:mock-when doc:name="call read-file" doc:id="18b6a96e-7166-4bb2-9bdf-0d2430b75438" processor="flow-ref">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="7f14c9bd-bf5f-41dc-af64-96512665c0e4" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[readUrl("classpath://mocks/read-file.dwl")]' mediaType="application/csv" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:spy doc:name="Spy" doc:id="1946cc49-9cdd-4396-bd95-c1532062be7f" processor="ee:transform">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="1b51aa41-fded-4728-8010-dcb92684251d" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:after-call >
					<munit-tools:assert-equals doc:name="should be able to make the payload as expected." doc:id="af788e66-d56a-4dce-9cd7-516ea5b6e730" actual="#[payload]" expected='#[readUrl("classpath://mocks/transform-data.dwl")]'/>
				</munit-tools:after-call>
			</munit-tools:spy>
			<munit-tools:mock-when doc:name="call send-to-database" doc:id="15872f26-6abf-465a-a352-8b8cebef79aa" processor="flow-ref">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="e4072c82-ba89-49cc-bec7-65daa41ff501" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[readUrl("classpath://mocks/transform-data.dwl")]' />
				</munit-tools:then-return>
			</munit-tools:mock-when>
			<munit-tools:mock-when doc:name="call move-file" doc:id="8d63e5d6-0a85-43d1-b48c-4fd05633874b" processor="flow-ref">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="f48e0336-da16-49b0-aa75-8d365a5d6066" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value='#[readUrl("classpath://mocks/transform-data.dwl")]' />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<flow-ref doc:name="ref to main" doc:id="0d2e3e7a-179b-4e28-b68a-b579368b869d" name="scheduler"/>
		</munit:execution>
		<munit:validation >
			<munit-tools:verify-call doc:name="should be able to call the start of the integration" doc:id="92d06f2a-a1c4-4255-99b0-4455df337194" processor="logger" times="1">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="391d9ed8-76fd-45cb-8666-4cc0f5a26288" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
			<munit-tools:verify-call doc:name="should be able to call the end of integration" doc:id="06120634-d5c2-46de-b2f3-b21c7e9ac20b" processor="logger" times="1">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="ecdbbccc-0113-4411-8d53-6a28395e370f" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
			<munit-tools:verify-call doc:name="shouldn't be able to call the integration's default logger" doc:id="f9a8458f-6973-48e3-a9ea-450f6a83ef03" processor="logger" times="0">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="c9da5f61-d5f6-41e9-98e4-631e473170cc" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
			<munit-tools:verify-call doc:name="shouldn't be able to call the GlobalErrorHandler" doc:id="8510fa0e-6e21-43a8-aeb7-d60cbc7e8e3e" processor="logger" times="0">
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="70a1afa9-41ea-4e29-a1a0-41e72e45556d" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
		</munit:validation>
	</munit:test>
	<munit:test name="main-test-suiteTest" doc:id="11e8f839-5fc5-44c7-8c6e-1c5142c0d93a" >
		<munit:behavior >
			<munit-tools:mock-when doc:name="call read-file" doc:id="6f6d5f45-7b93-423b-aac5-013669dbed0b" processor="flow-ref" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="7f14c9bd-bf5f-41dc-af64-96512665c0e4" attributeName="doc:id" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:payload value="#[null]" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<flow-ref doc:name="ref to main" doc:id="44a5eec7-81c5-4058-ba99-f23872d04b25" name="scheduler" />
		</munit:execution>
		<munit:validation >
			<munit-tools:verify-call doc:name="should be able to call the start of the integration" doc:id="9cb7d9c6-57cd-4b19-b58e-2f2251cb7171" processor="logger" times="1" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="391d9ed8-76fd-45cb-8666-4cc0f5a26288" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
			<munit-tools:verify-call doc:name="should be able to call the integration's default logger" doc:id="613a8c9b-64da-4d3d-afa2-1f12e2225833" processor="logger" times="1">
				<munit-tools:with-attributes>
					<munit-tools:with-attribute whereValue="c9da5f61-d5f6-41e9-98e4-631e473170cc" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
			<munit-tools:verify-call doc:name="should be able to call the end of integration" doc:id="556503f1-caa4-4072-be92-d6285bcd6ed5" processor="logger" times="1" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="ecdbbccc-0113-4411-8d53-6a28395e370f" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
			<munit-tools:verify-call doc:name="shouldn't be able to call the GlobalErrorHandler" doc:id="6958afbe-00a5-4277-82d3-ea66d518a2fc" processor="logger" times="0" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="70a1afa9-41ea-4e29-a1a0-41e72e45556d" attributeName="doc:id" />
				</munit-tools:with-attributes>
			</munit-tools:verify-call>
		</munit:validation>
	</munit:test>


</mule>